datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Account {
  id             Int      @id @default(autoincrement())
  username       String   @unique
  password       String?  // Encrypted password (optional - can use session-based auth)
  status         String   @default("idle")
  proxy          String?
  sessionPath    String?
  openaiPromptId String?  // OpenAI prompt ID for message generation
  lastActive     DateTime @default(now())
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  reels          Reel[]
  logs           Log[]

  @@index([status])
  @@index([username])
}

model Reel {
  id          Int       @id @default(autoincrement())
  account     Account   @relation(fields: [accountId], references: [id], onDelete: Cascade)
  accountId   Int
  reelUrl     String
  views       Int
  isAd        Boolean   @default(false)
  isLive      Boolean   @default(false)
  processedAt DateTime  @default(now())
  createdAt   DateTime  @default(now())
  outreach    Outreach[]

  @@index([accountId])
  @@index([views])
  @@index([processedAt])
}

model Outreach {
  id          Int      @id @default(autoincrement())
  reel        Reel     @relation(fields: [reelId], references: [id], onDelete: Cascade)
  reelId      Int
  targetUser  String
  message     String
  sent        Boolean  @default(false)
  sentAt      DateTime?
  createdAt   DateTime @default(now())

  @@index([reelId])
  @@index([sent])
}

model Log {
  id          Int      @id @default(autoincrement())
  account     Account  @relation(fields: [accountId], references: [id], onDelete: Cascade)
  accountId   Int
  level       String
  message     String
  metadata    String?  // JSON string for additional data
  createdAt   DateTime @default(now())

  @@index([accountId])
  @@index([createdAt])
}

